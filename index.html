<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ChatFlow</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-tr from-purple-400 to-pink-400 min-h-screen flex items-center justify-center p-4">

  <div class="bg-white rounded-xl shadow-lg w-full max-w-md flex flex-col h-[600px]">
    <div class="bg-gradient-to-r from-blue-500 to-pink-500 text-white rounded-t-xl p-4">
      <h1 class="text-xl font-bold">ChatBotðŸ¤–</h1>
      <p class="text-sm opacity-80">Please Type Your Queries!!</p>
    </div>

    <div id="chat-box" class="flex-1 overflow-y-auto p-4 space-y-4">
      <!-- Messages will appear here -->
    </div>

    <form id="chat-form" class="p-4 flex gap-2 border-t">
      <input id="user-input" type="text" placeholder="Type Here.." class="flex-1 p-2 border rounded-xl" required />
      <button type="submit" class="bg-purple-500 text-white px-4 py-2 rounded-xl">Send</button>
    </form>
  </div>

<script>
let generatingMessageElem; // To keep track of the "Generating..." message

const sendMessage = async () => {
    const input = document.getElementById('user-input');
    const message = input.value.trim();
    if (message === "") return;

    appendMessage(message, 'user');
    input.value = '';

    // Show "Generating..." text as loading message
    generatingMessageElem = appendMessage('Generating...', 'assistant', true);

    try {
        const response = await fetch('http://127.0.0.1:5000/chat', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ query: message })
        });

        if (!response.ok) {
            throw new Error('Network response was not ok');
        }

        const data = await response.json();
        // Remove the "Generating..." message and append the actual response
        generatingMessageElem.remove();
        appendMessage(data.answer, 'assistant');
    } catch (error) {
        console.error('Error:', error);
        // Remove the "Generating..." message and display an error message
        generatingMessageElem.remove();
        appendMessage('Error fetching answer.', 'assistant');
    }
};

const appendMessage = (text, sender, isLoading = false) => {
    const chat = document.getElementById('chat-box');
    const messageElem = document.createElement('div');
    messageElem.className = `flex items-start mb-4 ${sender === 'user' ? 'justify-end' : 'justify-start'}`;

    // If it's the "Generating..." message
    if (isLoading) {
        messageElem.className += ' text-gray-400'; // Light color for loading message
    }

    // Response message for bot
    if (sender === 'assistant') {
        messageElem.innerHTML = `
            <div class="max-w-xs p-3 rounded-lg bg-gray-200 text-black">
                ${text}
            </div>
        `;
    } else {
        // User message
        messageElem.innerHTML = `
            <div class="max-w-xs p-3 rounded-lg bg-blue-500 text-white">
                ${text}
            </div>
        `;
    }

    chat.appendChild(messageElem);
    chat.scrollTop = chat.scrollHeight;

    // Return the "Generating..." message element for removal later
    if (isLoading) {
        return messageElem;
    }
};

document.getElementById('chat-form').addEventListener('submit', function(event) {
    event.preventDefault();
    sendMessage();
});
</script>

</body>
</html>
